<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>EPUB 다운로드 허브</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e2e8f0; --accent:#22c55e; --accent2:#60a5fa; }
    *{box-sizing:border-box}
    body{margin:0;padding:16px;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
    h1{font-size:22px;margin:0 0 12px 0}
    .card{background:var(--card);border-radius:14px;padding:14px;margin:10px 0;box-shadow:0 8px 24px rgba(0,0,0,0.25)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .row>*{flex:1 1 160px;min-width:160px}
    input,select{width:100%;padding:12px;background:#0b1220;color:var(--text);border:1px solid #1f2937;border-radius:10px;outline:none}
    input:focus,select:focus{border-color:var(--accent2)}
    .btn{display:inline-block;padding:10px 14px;background:var(--accent);color:#052e13;border-radius:10px;text-decoration:none;font-weight:700}
    .btn.alt{background:#0b1220;color:var(--text);border:1px solid #1f2937;margin-left:6px}
    .entry{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px;border:1px solid #1f2937;border-radius:12px;margin:8px 0;background:#0b1220}
    .title{font-weight:700}
    .muted{color:var(--muted);font-size:12px}
    .footer{text-align:center;color:var(--muted);margin-top:20px;font-size:12px}
  </style>
</head>
<body>
  <h1>2025 서울동행인문학</h1>
  <h1>(한사람을 위한 미술인문학) 개인을 넘어 우리 : AI를 활용한 글과 그림책 수업</h1>
  <h3>📚 전자책(EPUB) 다운로드 허브</h3>
  <h3>📚 전자책 다운로드는 2025년 10월 10일까지 가능합니다.</h3>

  <div class="card">
    <div class="row">
      <div>
        <label class="muted">작가 선택</label>
        <select id="lecturerSelect"></select>
      </div>
      <div>
        <label class="muted">검색 (작품명/소속/작가명)</label>
        <input id="searchInput" type="search" placeholder="예) 윤동주"/>
      </div>
    </div>
  </div>

  <div id="listArea"></div>

  <div class="footer">
    서대문구 평생학습관 융복합 인재교육센터<br/>
  </div>

<script>
const DATASET = [
  { "소속":"서대문구 평생학습관", "작가명":"구희진", "작품명":"Stage in the FOREST 숲속 무대",  "파일링크":"epub/구희진작가_f.epub" },
  { "소속":"서대문구 평생학습관", "작가명":"김미연", "작품명":"희망안에서", "파일링크":"epub/김미연작가_f.epub" },
  { "소속":"서대문구 평생학습관", "작가명":"김은진", "작품명":"꽃은, 다시 핀다", "파일링크":"epub/김은진작가_f.epub" },
  { "소속":"서대문구 평생학습관", "작가명":"김조세린", "작품명":"오늘의 나를 만든 어제의 숨결", "파일링크":"epub/김조세린작가_f.epub" },
  { "소속":"서대문구 평생학습관", "작가명":"박진경", "작품명":"고통을 넘어 희망으로", "파일링크":"epub/박진경작가_f.epub" },
  { "소속":"서대문구 평생학습관", "작가명":"오진경", "작품명":"스쳐간 순간들이 모여 내 안에 길을 놓았다", "파일링크":"epub/오진경작가_f.epub" },
  { "소속":"서대문구 평생학습관", "작가명":"이선화", "작품명":"달팽이의 아침.저녁 그리고.지금", "파일링크":"epub/이선화작가_f.epub" },
  { "소속":"서대문구 평생학습관", "작가명":"이재홍", "작품명":"허우적거리며 배우다", "파일링크":"epub/이재홍작가_f.epub" },
  { "소속":"서대문구 평생학습관", "작가명":"이정은", "작품명":"삶을 잇는 작은 실", "파일링크":"epub/이정은작가_f.epub" },
  { "소속":"서대문구 평생학습관", "작가명":"장영숙", "작품명":"괜찮아, 오늘도... 괜찮아, 내일도...", "파일링크":"epub/장영숙작가_f.epub" },
  { "소속":"서대문구 평생학습관", "작가명":"정연경", "작품명":"60+ 삶을 향한 깊은 뿌리와 새로운 가치", "파일링크":"epub/정연경작가_f.epub" },
  { "소속":"서대문구 평생학습관", "작가명":"정혜욱", "작품명":"삶은 여행이고, 나는 여전히 길위에 있다.", "파일링크":"epub/정혜욱작가_f.epub" },
  { "소속":"서대문구 평생학습관", "작가명":"조미영", "작품명":"숨빛 Breathing light", "파일링크":"epub/조미영작가_f.epub" }
];

// 고유 작가명 리스트
function getLecturers(){
  const set = new Set(DATASET.map(x => x["작가명"]));
  return ["(전체)"].concat([...set].sort());
}

function renderLecturerOptions(){
  const sel = document.getElementById("lecturerSelect");
  sel.innerHTML = "";
  getLecturers().forEach(name => {
    const opt = document.createElement("option");
    opt.value = name;
    opt.textContent = name;
    sel.appendChild(opt);
  });
  const q = new URLSearchParams(location.search).get("lecturer");
  if(q) sel.value = q;
}

function renderList(){
  const area = document.getElementById("listArea");
  const lecturer = document.getElementById("lecturerSelect").value;
  const q = document.getElementById("searchInput").value.trim().toLowerCase();
  const repoName = location.pathname.split("/")[1]; // "epub-hub"

  let arr = DATASET.slice();
  if(lecturer && lecturer !== "(전체)") arr = arr.filter(x => x["작가명"]===lecturer);
  if(q){
    arr = arr.filter(x =>
      (x["작품명"]||"").toLowerCase().includes(q) ||
      (x["소속"]||"").toLowerCase().includes(q) ||
      (x["작가명"]||"").toLowerCase().includes(q)
    );
  }

  area.innerHTML = "";
  if(arr.length===0){
    area.innerHTML = '<div class="card muted">결과가 없습니다.</div>';
    return;
  }

  const byLect = arr.reduce((acc,cur)=>{
    const key = cur["작가명"]||"미지정";
    (acc[key] ||= []).push(cur);
    return acc;
  },{});

  Object.keys(byLect).sort().forEach(lect => {
    const group = byLect[lect];
    const card = document.createElement("div");
    card.className = "card";
    const header = document.createElement("div");
    header.innerHTML = '<div class="title">👤 '+escapeHtml(lect)+'</div><div class="muted">'+group.length+'개 항목</div>';
    card.appendChild(header);

    group.forEach(item => {
      const row = document.createElement("div");
      row.className = "entry";
      const title = escapeHtml(item["작품명"]||"");
      const org = escapeHtml(item["소속"]||"");
      const raw = (item["파일링크"]||"").trim();

      row.innerHTML = `
        <div>
          <div class="title">${title}</div>
          <div class="muted">${org}</div>
        </div>
        <div class="actions"></div>
      `;

      const actions = row.querySelector('.actions');

      // 다운로드 버튼
      const dl = document.createElement('a');
      dl.className = 'btn';
      dl.href = raw;
      dl.target = '_blank';
      dl.rel = 'noopener';
      dl.textContent = '다운로드';
      actions.appendChild(dl);

      // ✅ 미리보기 버튼
      let u = null;
      try { u = new URL(raw, location.href); } catch (e) {}
      const isSameOrigin = u && u.origin === location.origin;
      const p = u ? u.pathname.toLowerCase() : "";
      const looksLikeEpub = p.includes("/epub/") && p.endsWith(".epub");

      if (isSameOrigin && looksLikeEpub) {
        let relative = raw.replace(/^\//, "");
        if (relative.startsWith(repoName + "/")) {
          relative = relative.substring(repoName.length + 1);
        }
        const pv = document.createElement('a');
        pv.className = 'btn alt';
        pv.href = 'viewer.html?book=' + encodeURIComponent(relative);
        pv.target = '_blank';
        pv.rel = 'noopener';
        pv.textContent = '미리보기';
        actions.appendChild(pv);
      }

      card.appendChild(row);
    });

    area.appendChild(card);
  });
}

function escapeHtml(s){
  return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;");
}

document.getElementById("lecturerSelect").addEventListener("change", renderList);
document.getElementById("searchInput").addEventListener("input", renderList);

renderLecturerOptions();
renderList();
</script>
</body>
</html>
