<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>EPUB Îã§Ïö¥Î°úÎìú ÌóàÎ∏å</title>
    <style>
      :root {
        --bg: #0f172a;
        --card: #111827;
        --card-hover: #1f2937;
        --muted: #94a3b8;
        --text: #e2e8f0;
        --accent: #22c55e;
        --accent2: #60a5fa;
        --border: #374151;
        --pdf-color: #f59e0b;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 16px;
        background: var(--bg);
        color: var(--text);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        line-height: 1.6;
      }

      .header {
        text-align: center;
        margin-bottom: 32px;
      }

      h1 {
        font-size: 28px;
        margin: 0 0 8px 0;
        font-weight: 700;
        background: linear-gradient(135deg, var(--accent), var(--accent2));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      h3 {
        font-size: 18px;
        margin: 8px 0;
        color: var(--muted);
        font-weight: 500;
      }

      .search-card {
        background: var(--card);
        border-radius: 16px;
        padding: 24px;
        margin: 24px 0;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border: 1px solid var(--border);
      }

      .search-row {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 16px;
        align-items: end;
      }

      .view-mode-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid var(--border);
      }

      .view-mode-buttons {
        display: flex;
        gap: 8px;
        justify-content: center;
      }

      .view-mode-btn {
        padding: 10px 20px;
        background: rgba(96, 165, 250, 0.1);
        color: var(--accent2);
        border: 1px solid rgba(96, 165, 250, 0.3);
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .view-mode-btn:hover {
        background: rgba(96, 165, 250, 0.2);
        border-color: var(--accent2);
      }

      .view-mode-btn.active {
        background: var(--accent2);
        color: #0c4a6e;
        border-color: var(--accent2);
      }

      .pdf-download-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid var(--border);
        text-align: center;
      }

      .pdf-download-all-btn {
        padding: 12px 24px;
        background: var(--pdf-color);
        color: #451a03;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .pdf-download-all-btn:hover {
        background: #d97706;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
      }

      @media (max-width: 768px) {
        .search-row {
          grid-template-columns: 1fr;
          gap: 16px;
        }

        .view-mode-buttons {
          flex-direction: column;
          gap: 12px;
        }
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      label {
        color: var(--muted);
        font-size: 14px;
        font-weight: 500;
      }

      input,
      select {
        width: 100%;
        padding: 12px 16px;
        background: #0b1220;
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: 10px;
        outline: none;
        transition: border-color 0.2s ease;
      }

      input:focus,
      select:focus {
        border-color: var(--accent2);
      }

      .books-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 24px;
        margin: 32px 0;
      }

      .book-card {
        background: var(--card);
        border-radius: 16px;
        padding: 20px;
        border: 1px solid var(--border);
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .book-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(34, 197, 94, 0.1),
          rgba(96, 165, 250, 0.1)
        );
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 1;
        pointer-events: none;
      }

      .book-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        border-color: var(--accent2);
      }

      .book-card:hover::before {
        opacity: 1;
      }

      .book-cover {
        width: 100%;
        height: 200px;
        background: linear-gradient(135deg, #1f2937, #374151);
        border-radius: 12px;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        border: 2px solid var(--border);
        z-index: 2;
      }

      .book-cover img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 10px;
      }

      .book-cover .no-image {
        color: var(--muted);
        font-size: 48px;
        opacity: 0.5;
      }

      .book-info {
        z-index: 2;
        position: relative;
      }

      .book-title {
        font-size: 18px;
        font-weight: 700;
        margin: 0 0 8px 0;
        color: var(--text);
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .book-author {
        font-size: 16px;
        font-weight: 600;
        color: var(--accent);
        margin: 0 0 4px 0;
      }

      .book-org {
        font-size: 14px;
        color: var(--muted);
        margin: 0 0 20px 0;
      }

      .book-actions {
        display: flex;
        flex-direction: column;
        gap: 12px;
        z-index: 2;
        position: relative;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 10px 16px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        gap: 6px;
      }

      .btn-primary {
        background: var(--accent);
        color: #052e13;
        flex: 1;
      }

      .btn-primary:hover {
        background: #16a34a;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(34, 197, 94, 0.3);
      }

      .btn-secondary {
        background: rgba(96, 165, 250, 0.1);
        color: var(--accent2);
        border: 1px solid rgba(96, 165, 250, 0.3);
        flex: 1;
      }

      .btn-secondary:hover {
        background: rgba(96, 165, 250, 0.2);
        border-color: var(--accent2);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(96, 165, 250, 0.2);
      }

      .btn-pdf {
        background: var(--pdf-color);
        color: #451a03;
        flex: 1;
      }

      .btn-pdf:hover {
        background: #d97706;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
      }

      .no-results {
        text-align: center;
        padding: 60px 20px;
        color: var(--muted);
        font-size: 18px;
      }

      .no-results-icon {
        font-size: 64px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .author-section {
        margin: 40px 0 24px 0;
      }

      .author-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
        padding: 16px 0;
        border-bottom: 2px solid var(--border);
      }

      .author-name {
        font-size: 24px;
        font-weight: 700;
        color: var(--text);
        margin: 0;
      }

      .author-count {
        background: var(--accent);
        color: #052e13;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }

      .footer {
        text-align: center;
        color: var(--muted);
        margin-top: 60px;
        padding-top: 40px;
        border-top: 1px solid var(--border);
        font-size: 14px;
      }

      @media (max-width: 1200px) {
        .books-grid {
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 20px;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 12px;
        }

        .books-grid {
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          gap: 16px;
        }

        .search-card {
          padding: 20px;
        }

        h1 {
          font-size: 24px;
        }

        .author-name {
          font-size: 20px;
        }
      }

      @media (max-width: 480px) {
        .books-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>2025 ÏÑúÏö∏ÎèôÌñâÏù∏Î¨∏Ìïô</h1>
      <h1>
        (ÌïúÏÇ¨ÎûåÏùÑ ÏúÑÌïú ÎØ∏Ïà†Ïù∏Î¨∏Ìïô) Í∞úÏù∏ÏùÑ ÎÑòÏñ¥ Ïö∞Î¶¨ : AIÎ•º ÌôúÏö©Ìïú Í∏ÄÍ≥º Í∑∏Î¶ºÏ±Ö
        ÏàòÏóÖ
      </h1>
      <h3>üìö Ï†ÑÏûêÏ±Ö(EPUB) Îã§Ïö¥Î°úÎìú ÌóàÎ∏å</h3>
      <h3>üìö Ï†ÑÏûêÏ±Ö Îã§Ïö¥Î°úÎìúÎäî 2025ÎÖÑ 10Ïõî 10ÏùºÍπåÏßÄ Í∞ÄÎä•Ìï©ÎãàÎã§.</h3>
    </div>

    <div class="search-card">
      <div class="search-row">
        <div class="form-group">
          <label for="lecturerSelect">ÏûëÍ∞Ä ÏÑ†ÌÉù</label>
          <select id="lecturerSelect"></select>
        </div>
        <div class="form-group">
          <label for="searchInput">Í≤ÄÏÉâ (ÏûëÌíàÎ™Ö/ÏÜåÏÜç/ÏûëÍ∞ÄÎ™Ö)</label>
          <input id="searchInput" type="search" placeholder="Ïòà) Ïú§ÎèôÏ£º" />
        </div>
      </div>

      <div class="view-mode-section">
        <div class="view-mode-buttons">
          <button id="authorView" class="view-mode-btn active">
            üìö ÏûëÍ∞ÄÎ≥Ñ Î≥¥Í∏∞
          </button>
          <button id="gridView" class="view-mode-btn">üì≤ Ï†ÑÏ≤¥ Î≥¥Í∏∞</button>
        </div>
      </div>

      <div class="pdf-download-section">
        <button id="downloadAllPdf" class="pdf-download-all-btn">
          üìÑ Ï†ÑÏ≤¥ PDF ÌïúÎ≤àÏóê Îã§Ïö¥Î°úÎìú
        </button>
      </div>
    </div>

    <div id="listArea"></div>

    <div class="footer">ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä ÏúµÎ≥µÌï© Ïù∏Ïû¨ÍµêÏú°ÏÑºÌÑ∞</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
      let currentViewMode = "author";

      const DATASET = [
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "Íµ¨Ìù¨ÏßÑ",
          ÏûëÌíàÎ™Ö: "Stage in the FOREST Ïà≤ÏÜç Î¨¥ÎåÄ",
          ÌååÏùºÎßÅÌÅ¨: "epub/Íµ¨Ìù¨ÏßÑÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/Íµ¨Ìù¨ÏßÑÏûëÍ∞Ä_f.jpg",
          pdf: "resources/Íµ¨Ìù¨ÏßÑÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "ÍπÄÎØ∏Ïó∞",
          ÏûëÌíàÎ™Ö: "Ìù¨ÎßùÏïàÏóêÏÑú",
          ÌååÏùºÎßÅÌÅ¨: "epub/ÍπÄÎØ∏Ïó∞ÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/ÍπÄÎØ∏Ïó∞ÏûëÍ∞Ä_f.jpg",
          pdf: "resources/ÍπÄÎØ∏Ïó∞ÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "ÍπÄÏùÄÏßÑ",
          ÏûëÌíàÎ™Ö: "ÍΩÉÏùÄ, Îã§Ïãú ÌïÄÎã§",
          ÌååÏùºÎßÅÌÅ¨: "epub/ÍπÄÏùÄÏßÑÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/ÍπÄÏùÄÏßÑÏûëÍ∞Ä_f.jpg",
          pdf: "resources/ÍπÄÏùÄÏßÑÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "ÍπÄÏ°∞ÏÑ∏Î¶∞",
          ÏûëÌíàÎ™Ö: "Ïò§ÎäòÏùò ÎÇòÎ•º ÎßåÎì† Ïñ¥Ï†úÏùò Ïà®Í≤∞",
          ÌååÏùºÎßÅÌÅ¨: "epub/ÍπÄÏ°∞ÏÑ∏Î¶∞ÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/ÍπÄÏ°∞ÏÑ∏Î¶∞ÏûëÍ∞Ä_f.jpg",
          pdf: "resources/ÍπÄÏ°∞ÏÑ∏Î¶∞ÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "Î∞ïÏßÑÍ≤Ω",
          ÏûëÌíàÎ™Ö: "Í≥†ÌÜµÏùÑ ÎÑòÏñ¥ Ìù¨ÎßùÏúºÎ°ú",
          ÌååÏùºÎßÅÌÅ¨: "epub/Î∞ïÏßÑÍ≤ΩÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/Î∞ïÏßÑÍ≤ΩÏûëÍ∞Ä_f.jpg",
          pdf: "resources/Î∞ïÏßÑÍ≤ΩÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "Ïò§ÏßÑÍ≤Ω",
          ÏûëÌíàÎ™Ö: "Ïä§Ï≥êÍ∞Ñ ÏàúÍ∞ÑÎì§Ïù¥ Î™®Ïó¨ ÎÇ¥ ÏïàÏóê Í∏∏ÏùÑ ÎÜìÏïòÎã§",
          ÌååÏùºÎßÅÌÅ¨: "epub/Ïò§ÏßÑÍ≤ΩÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/Ïò§ÏßÑÍ≤ΩÏûëÍ∞Ä_f.jpg",
          pdf: "resources/Ïò§ÏßÑÍ≤ΩÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "Ïù¥ÏÑ†Ìôî",
          ÏûëÌíàÎ™Ö: "Îã¨ÌåΩÏù¥Ïùò ÏïÑÏπ®.Ï†ÄÎÖÅ Í∑∏Î¶¨Í≥†.ÏßÄÍ∏à",
          ÌååÏùºÎßÅÌÅ¨: "epub/Ïù¥ÏÑ†ÌôîÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/Ïù¥ÏÑ†ÌôîÏûëÍ∞Ä_f.jpg",
          pdf: "resources/Ïù¥ÏÑ†ÌôîÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "Ïù¥Ïû¨Ìôç",
          ÏûëÌíàÎ™Ö: "ÌóàÏö∞Ï†ÅÍ±∞Î¶¨Î©∞ Î∞∞Ïö∞Îã§",
          ÌååÏùºÎßÅÌÅ¨: "epub/Ïù¥Ïû¨ÌôçÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/Ïù¥Ïû¨ÌôçÏûëÍ∞Ä_f.jpg",
          pdf: "resources/Ïù¥Ïû¨ÌôçÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "Ïù¥Ï†ïÏùÄ",
          ÏûëÌíàÎ™Ö: "ÏÇ∂ÏùÑ ÏûáÎäî ÏûëÏùÄ Ïã§",
          ÌååÏùºÎßÅÌÅ¨: "epub/Ïù¥Ï†ïÏùÄÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/Ïù¥Ï†ïÏùÄÏûëÍ∞Ä_f.jpg",
          pdf: "resources/Ïù¥Ï†ïÏùÄÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "Ïû•ÏòÅÏàô",
          ÏûëÌíàÎ™Ö: "Í¥úÏ∞ÆÏïÑ, Ïò§ÎäòÎèÑ... Í¥úÏ∞ÆÏïÑ, ÎÇ¥ÏùºÎèÑ...",
          ÌååÏùºÎßÅÌÅ¨: "epub/Ïû•ÏòÅÏàôÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/Ïû•ÏòÅÏàôÏûëÍ∞Ä_f.jpg",
          pdf: "resources/Ïû•ÏòÅÏàôÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "Ï†ïÏó∞Í≤Ω",
          ÏûëÌíàÎ™Ö: "60+ ÏÇ∂ÏùÑ Ìñ•Ìïú ÍπäÏùÄ ÎøåÎ¶¨ÏôÄ ÏÉàÎ°úÏö¥ Í∞ÄÏπò",
          ÌååÏùºÎßÅÌÅ¨: "epub/Ï†ïÏó∞Í≤ΩÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/Ï†ïÏó∞Í≤ΩÏûëÍ∞Ä_f.jpg",
          pdf: "resources/Ï†ïÏó∞Í≤ΩÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "Ï†ïÌòúÏö±",
          ÏûëÌíàÎ™Ö: "ÏÇ∂ÏùÄ Ïó¨ÌñâÏù¥Í≥†, ÎÇòÎäî Ïó¨Ï†ÑÌûà Í∏∏ÏúÑÏóê ÏûàÎã§.",
          ÌååÏùºÎßÅÌÅ¨: "epub/Ï†ïÌòúÏö±ÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/Ï†ïÌòúÏö±ÏûëÍ∞Ä_f.jpg",
          pdf: "resources/Ï†ïÌòúÏö±ÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "Ï°∞ÎØ∏ÏòÅ",
          ÏûëÌíàÎ™Ö: "Ïà®Îπõ Breathing light",
          ÌååÏùºÎßÅÌÅ¨: "epub/Ï°∞ÎØ∏ÏòÅÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/Ï°∞ÎØ∏ÏòÅÏûëÍ∞Ä_f.jpg",
          pdf: "resources/Ï°∞ÎØ∏ÏòÅÏûëÍ∞Ä_f.pdf",
        },
        {
          ÏÜåÏÜç: "ÏÑúÎåÄÎ¨∏Íµ¨ ÌèâÏÉùÌïôÏäµÍ¥Ä",
          ÏûëÍ∞ÄÎ™Ö: "ÌïúÎØ∏Ìôî",
          ÏûëÌíàÎ™Ö: "ÏÇ∂ ÏÜçÏóêÏÑú Î≥¥ÏÑùÏùÑ Î∞úÍ≤¨ÌïòÎ©∞",
          ÌååÏùºÎßÅÌÅ¨: "epub/ÌïúÎØ∏ÌôîÏûëÍ∞Ä_f.epub",
          ÌëúÏßÄ: "resources/ÌïúÎØ∏ÌôîÏûëÍ∞Ä_f.jpg",
          pdf: "resources/ÌïúÎØ∏ÌôîÏûëÍ∞Ä_f.pdf",
        },
      ];

      function getLecturers() {
        const set = new Set(DATASET.map((x) => x["ÏûëÍ∞ÄÎ™Ö"]));
        return ["(Ï†ÑÏ≤¥)"].concat([...set].sort());
      }

      function renderLecturerOptions() {
        const sel = document.getElementById("lecturerSelect");
        sel.innerHTML = "";
        getLecturers().forEach((name) => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          sel.appendChild(opt);
        });
        const q = new URLSearchParams(location.search).get("lecturer");
        if (q) sel.value = q;
      }

      function createBookCard(item) {
        const title = escapeHtml(item["ÏûëÌíàÎ™Ö"] || "");
        const author = escapeHtml(item["ÏûëÍ∞ÄÎ™Ö"] || "");
        const org = escapeHtml(item["ÏÜåÏÜç"] || "");
        const coverImage = item["ÌëúÏßÄ"] || "";
        const raw = (item["ÌååÏùºÎßÅÌÅ¨"] || "").trim();
        const pdfLink = item["pdf"] || "";

        const card = document.createElement("div");
        card.className = "book-card";

        let coverHtml = "";
        if (coverImage) {
          coverHtml = `<img src="${coverImage}" alt="${title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                       <div class="no-image" style="display:none;">üìñ</div>`;
        } else {
          coverHtml = '<div class="no-image">üìñ</div>';
        }

        let pdfButtonHtml = "";
        if (pdfLink) {
          pdfButtonHtml = `<a href="${pdfLink}" class="btn btn-pdf" target="_blank" rel="noopener" download>
            üìÑ PDF Îã§Ïö¥Î°úÎìú
          </a>`;
        }

        card.innerHTML = `
          <div class="book-cover">
            ${coverHtml}
          </div>
          <div class="book-info">
            <div class="book-author">‚úèÔ∏è ${author}</div>
            <h3 class="book-title">${title}</h3>
            <div class="book-org">üèõÔ∏è ${org}</div>
            <div class="book-actions">
              <a href="${raw}" class="btn btn-primary" target="_blank" rel="noopener">
                üì• EPUB Îã§Ïö¥Î°úÎìú
              </a>
              <a href="#" class="btn btn-secondary preview-btn" data-book="${encodeURIComponent(
                raw
              )}">
                üëÅÔ∏è ÎØ∏Î¶¨Î≥¥Í∏∞
              </a>
              ${pdfButtonHtml}
            </div>
          </div>
        `;

        return card;
      }

      function renderList() {
        const area = document.getElementById("listArea");
        const lecturer = document.getElementById("lecturerSelect").value;
        const q = document
          .getElementById("searchInput")
          .value.trim()
          .toLowerCase();

        let arr = DATASET.slice();
        if (lecturer && lecturer !== "(Ï†ÑÏ≤¥)") {
          arr = arr.filter((x) => x["ÏûëÍ∞ÄÎ™Ö"] === lecturer);
        }
        if (q) {
          arr = arr.filter(
            (x) =>
              (x["ÏûëÌíàÎ™Ö"] || "").toLowerCase().includes(q) ||
              (x["ÏÜåÏÜç"] || "").toLowerCase().includes(q) ||
              (x["ÏûëÍ∞ÄÎ™Ö"] || "").toLowerCase().includes(q)
          );
        }

        area.innerHTML = "";

        if (arr.length === 0) {
          area.innerHTML = `
            <div class="no-results">
              <div class="no-results-icon">üìö</div>
              <div>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>
            </div>
          `;
          return;
        }

        if (currentViewMode === "grid") {
          const booksGrid = document.createElement("div");
          booksGrid.className = "books-grid";

          const sortedBooks = arr.sort((a, b) => {
            const authorA = a["ÏûëÍ∞ÄÎ™Ö"] || "";
            const authorB = b["ÏûëÍ∞ÄÎ™Ö"] || "";
            if (authorA === authorB) {
              return (a["ÏûëÌíàÎ™Ö"] || "").localeCompare(b["ÏûëÌíàÎ™Ö"] || "");
            }
            return authorA.localeCompare(authorB);
          });

          sortedBooks.forEach((book) => {
            const card = createBookCard(book);
            booksGrid.appendChild(card);
          });

          area.appendChild(booksGrid);
        } else {
          const byAuthor = arr.reduce((acc, cur) => {
            const key = cur["ÏûëÍ∞ÄÎ™Ö"] || "ÎØ∏ÏßÄÏ†ï";
            (acc[key] ||= []).push(cur);
            return acc;
          }, {});

          Object.keys(byAuthor)
            .sort()
            .forEach((author) => {
              const books = byAuthor[author];

              const authorSection = document.createElement("div");
              authorSection.className = "author-section";

              const authorHeader = document.createElement("div");
              authorHeader.className = "author-header";
              authorHeader.innerHTML = `
              <h2 class="author-name">‚úèÔ∏è ${escapeHtml(author)}</h2>
              <span class="author-count">${books.length}Í∂å</span>
            `;
              authorSection.appendChild(authorHeader);

              const booksGrid = document.createElement("div");
              booksGrid.className = "books-grid";

              books.forEach((book) => {
                const card = createBookCard(book);
                booksGrid.appendChild(card);
              });

              authorSection.appendChild(booksGrid);
              area.appendChild(authorSection);
            });
        }

        setupPreviewButtons();
      }

      function setupPreviewButtons() {
        const previewBtns = document.querySelectorAll(".preview-btn");
        previewBtns.forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.preventDefault();
            const bookParam = btn.getAttribute("data-book");
            const decodedBook = decodeURIComponent(bookParam);

            let relative = decodedBook.replace(/^\//, "");
            const repoName = location.pathname.split("/")[1];
            if (relative.startsWith(repoName + "/")) {
              relative = relative.substring(repoName.length + 1);
            }

            const viewerUrl =
              "viewer.html?book=" + encodeURIComponent(relative);
            window.open(viewerUrl, "_blank", "noopener");
          });
        });
      }

      async function downloadAllPdf() {
        const pdfBooks = DATASET.filter((book) => book.pdf);

        if (pdfBooks.length === 0) {
          alert("Îã§Ïö¥Î°úÎìú Í∞ÄÎä•Ìïú PDF ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§.");
          return;
        }

        const downloadBtn = document.getElementById("downloadAllPdf");
        const originalText = downloadBtn.textContent;

        try {
          downloadBtn.textContent = "üì¶ ZIP ÌååÏùº ÏÉùÏÑ± Ï§ë...";
          downloadBtn.disabled = true;

          const zip = new JSZip();

          // Î™®Îì† PDF ÌååÏùºÏùÑ fetchÌïòÏó¨ ZIPÏóê Ï∂îÍ∞Ä
          for (let i = 0; i < pdfBooks.length; i++) {
            const book = pdfBooks[i];
            downloadBtn.textContent = `üì¶ Ï≤òÎ¶¨ Ï§ë... (${i + 1}/${
              pdfBooks.length
            })`;

            try {
              const response = await fetch(book.pdf);
              const blob = await response.blob();
              const fileName = `${book.ÏûëÍ∞ÄÎ™Ö}_${book.ÏûëÌíàÎ™Ö}.pdf`;
              zip.file(fileName, blob);
              console.log(`‚úÖ Ï∂îÍ∞ÄÎê®: ${fileName}`);
            } catch (error) {
              console.error(`‚ùå Ïã§Ìå®: ${book.ÏûëÍ∞ÄÎ™Ö}`, error);
            }
          }

          // ZIP ÌååÏùº ÏÉùÏÑ± Î∞è Îã§Ïö¥Î°úÎìú
          downloadBtn.textContent = "üíæ ZIP ÌååÏùº Îã§Ïö¥Î°úÎìú Ï§ë...";
          const content = await zip.generateAsync({ type: "blob" });

          const link = document.createElement("a");
          link.href = URL.createObjectURL(content);
          link.download = "2025_ÏÑúÏö∏ÎèôÌñâÏù∏Î¨∏Ìïô_Ï†ÑÏ≤¥PDF.zip";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);

          alert(
            `${pdfBooks.length}Í∞úÏùò PDF ÌååÏùºÏù¥ ZIPÏúºÎ°ú Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.`
          );
        } catch (error) {
          console.error("ZIP ÏÉùÏÑ± Ïò§Î•ò:", error);
          alert("ZIP ÌååÏùº ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
        } finally {
          downloadBtn.textContent = originalText;
          downloadBtn.disabled = false;
        }
      }

      function escapeHtml(s) {
        return String(s)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      document.addEventListener("DOMContentLoaded", function () {
        renderLecturerOptions();
        renderList();

        document
          .getElementById("lecturerSelect")
          .addEventListener("change", renderList);
        document
          .getElementById("searchInput")
          .addEventListener("input", renderList);

        document
          .getElementById("authorView")
          .addEventListener("click", function () {
            currentViewMode = "author";
            document.getElementById("authorView").classList.add("active");
            document.getElementById("gridView").classList.remove("active");
            renderList();
          });

        document
          .getElementById("gridView")
          .addEventListener("click", function () {
            currentViewMode = "grid";
            document.getElementById("gridView").classList.add("active");
            document.getElementById("authorView").classList.remove("active");
            renderList();
          });

        document
          .getElementById("downloadAllPdf")
          .addEventListener("click", downloadAllPdf);
      });
    </script>
  </body>
</html>
